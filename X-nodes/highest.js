const Garfield=require("../events"),{MessageType:MessageType,Mimetype:Mimetype}=require("@adiwajshing/baileys"),translatte=require("translatte"),config=require("../config"),LanguageDetect=require("languagedetect"),lngDetector=new LanguageDetect,Heroku=require("heroku-client"),heroku=new Heroku({token:config.HEROKU.API_KEY});let baseURI="/apps/"+config.HEROKU.APP_NAME;const axios=require("axios"),fs=require("fs"),https=require("https"),ytdl=require("ytdl-core"),ffmpeg=require("fluent-ffmpeg"),yts=require("yt-search"),got=require("got"),ID3Writer=require("browser-id3-writer"),SpotifyWebApi=require("spotify-web-api-node"),spotifyApi=new SpotifyWebApi({clientId:"acc6302297e040aeb6e4ac1fbdfd62c3",clientSecret:"0e8439a1280a43aba9a5bc0a16f3f009"}),Language=require("../language"),Lang=Language.getString("scrapers"),LOAD_ING="```Downloading media...```";"off"!=config.Auroraxc&&"OFF"!=config.Auroraxc||Garfield.addXnodes({pattern:"get ?(.*)",fromMe:!1,desc:Lang.GET_DESC},async(e,a)=>{if(""===a[1])return await e.client.sendMessage(e.jid,Lang.NEED_SOME,MessageType.text);if(!a[1].includes("mp3")&&a[1].includes("youtu.be")||a[1].includes("youtube.com")){var t="";try{if(a[1].includes("watch")){var i=a[1].replace("watch?v=","").split("/")[3];t=i}else t=a[1].split("/")[3]}catch{return await e.client.sendMessage(e.jid,Lang.NO_RESULT,MessageType.text)}var s=await e.client.groupMetadata(e.jid),n=(await e.client.sendMessage(e.jid,Lang.DOWNLOADING_VIDEO,MessageType.text),ytdl(t,{filter:e=>"mp4"===e.container&&["720p","480p","360p","240p","144p"].map(()=>!0)}));n.pipe(fs.createWriteStream("./"+t+".mp4")),n.on("end",async()=>{await e.client.sendMessage(e.jid,Lang.UPLOADING_VIDEO+" for "+s.subject,MessageType.text),await e.client.sendMessage(e.jid,fs.readFileSync("./"+t+".mp4"),MessageType.video,{quoted:e.data,mimetype:Mimetype.mp4})})}if(a[1].includes("instagram.com")){const t=async(e,a)=>{const t=s;function i(){const e=["jul","htt","ps:","nti","ouy","aw.","kit","/in","sta","?ur","dat","get","arr"];return(i=function(){return e})()}function s(e,a){const t=i();return(s=function(e,a){return t[e-=229]})(e,a)}if(a!=t(229)+"ie")throw new Error("Julie");const n=await axios(t(230)+t(231)+"//u"+t(232)+"tled-1"+t(233)+"r1rszh"+t(234)+"run"+t(235)+".sh"+t(236)+t(237)+t(238)+"l="+e),{status:r,result:d}=n[t(239)+"a"];if(!r)return{status:r};const{type:c,data:o}=d[0];return{type:c,data:(await axios[t(240)](o,{responseType:t(241)+"aybuffer"}))[t(239)+"a"],status:r}},{status:i,type:s,data:n}=await t(a[1],"julie");if(!i)return await e.sendMessage("```server down will solve as soon as possible```");if(await e.client.sendMessage(e.jid,LOAD_ING,MessageType.text,{quoted:e.data}),"image"===s)return await e.sendMessage(n,MessageType.image,{caption:config.AFN,quoted:e.data});if("video"===s)return await e.sendMessage(n,MessageType.video,{caption:config.AFN,quoted:e.data})}if(!a[1].includes(".com")&&!a[1].includes("youtu.be")){let t=await yts(a[1]);if((t=t.all).length<1)return await e.client.sendMessage(e.jid,Lang.NO_RESULT,MessageType.text);await e.client.sendMessage(e.jid,Lang.DOWNLOADING_SONG,MessageType.text);let i=t[0].title.replace(" ","+"),s=ytdl(t[0].videoId,{quality:"highestaudio"});got.stream(t[0].image).pipe(fs.createWriteStream(i+".jpg")),ffmpeg(s).audioBitrate(320).save("./"+i+".mp3").on("end",async()=>{const s=new ID3Writer(fs.readFileSync("./"+i+".mp3"));s.setFrame("TIT2",t[0].title).setFrame("TPE1",[t[0].author.name]).setFrame("APIC",{type:3,data:fs.readFileSync(i+".jpg"),description:t[0].description}),s.addTag(),await e.client.sendMessage(e.jid,fs.readFileSync("./"+i+".jpg"),MessageType.image,{caption:"\n```Title -```\n*"+i+"*\n```Wait Uploading```"}),await e.client.sendMessage(e.jid,Buffer.from(s.arrayBuffer),MessageType.audio,{quoted:e.data,mimetype:Mimetype.mp4Audio,ptt:!1}),await e.client.sendMessage(e.jid,Buffer.from(s.arrayBuffer),MessageType.document,{filename:a[1].replace("mp3",config.AFN)+".mp3",mimetype:"audio/mpeg",quoted:e.data})})}if(a[1].includes("youtu.be")||a[1].includes("youtube.com")&&a[1].includes("mp3")){let t=await yts(a[1].replace("mp3",""));if((t=t.all).length<1)return await e.client.sendMessage(e.jid,Lang.NO_RESULT,MessageType.text);await e.client.sendMessage(e.jid,Lang.DOWNLOADING_SONG,MessageType.text);let i=t[0].title.replace(" ","+"),s=ytdl(t[0].videoId,{quality:"highest"});got.stream(t[0].image).pipe(fs.createWriteStream(i+".jpg")),ffmpeg(s).audioBitrate(320).save("./"+i+".mp3").on("end",async()=>{const a=new ID3Writer(fs.readFileSync("./"+i+".mp3"));a.setFrame("TIT2",t[0].title).setFrame("TPE1",[t[0].author.name]).setFrame("APIC",{type:3,data:fs.readFileSync(i+".jpg"),description:t[0].description}),a.addTag(),await e.client.sendMessage(e.jid,fs.readFileSync("./"+i+".jpg"),MessageType.image,{caption:"\n*Song Name -*\n*"+i+" üêº*\n\n"+Lang.UPLOADING_SONG+"\n"}),await e.client.sendMessage(e.jid,Buffer.from(a.arrayBuffer),MessageType.audio,{quoted:e.data,mimetype:Mimetype.mp4Audio,ptt:!1}),await e.client.sendMessage(e.jid,Buffer.from(a.arrayBuffer),MessageType.document,{filename:"garfield v6.0"+config.AFN+".mp3",mimetype:"audio/mpeg",quoted:e.data})})}if(a[1].includes("instagram.com")&&a[1].includes("mp3")||a[1].includes(".gov")||a[1].includes(".edu")||a[1].includes(".org")||a[1].includes(".net")||a[1].includes(".biz")||a[1].includes(".info")||a[1].includes(".facebook")){let t=a[1];await e.client.sendMessage(e.jid,"```"+Lang.LINK_TEXT+" : ```"+t+" \n ```"+Lang.NO_SPRT+"```",MessageType.text)}});
